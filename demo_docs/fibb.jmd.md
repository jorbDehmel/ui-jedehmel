# Recursive Fibbonacci With and Without Cache

The naive recursive Fibbonacci algorithm is infamous
for being bad. However, caching can make it good!


```CPP
// C++ code
#include <iostream>
#include <chrono>
#include <map>

int fibb(int n) {
  if (n < 2) {
    return n;
  }
  return fibb(n - 2) + fibb(n - 1);
}

int fibb_with_cache(int n) {
  static std::map<int, int> cache;
  if (cache.count(n) == 0) {
    if (n < 2) {
      cache[n] = n;
    } else {
      cache[n] = fibb_with_cache(n - 2) +
                 fibb_with_cache(n - 1);
    }
  }
  return cache.at(n);
}

int main() {
  std::cout << "Without cache:\n";
  for (int i = 0; i < 30; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }
  
  std::cout << "With cache:\n";
  for (int i = 0; i < 300; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb_with_cache(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }

  return 0;
}
```

```
Without cache:
0	0	3.21 us
1	1	0.343 us
2	1	0.286 us
3	2	0.243 us
4	3	0.278 us
5	5	0.354 us
6	8	0.402 us
7	13	0.503 us
8	21	0.618 us
9	34	0.699 us
10	55	0.973 us
11	89	1.277 us
12	144	1.942 us
13	233	2.968 us
14	377	4.613 us
15	610	7.322 us
16	987	11.736 us
17	1597	18.729 us
18	2584	30.108 us
19	4181	48.6 us
20	6765	108.75 us
21	10946	192.443 us
22	17711	343.707 us
23	28657	500.824 us
24	46368	836.501 us
25	75025	1352.46 us
26	121393	2250.81 us
27	196418	3436.05 us
28	317811	5757.18 us
29	514229	8679.18 us
With cache:
0	0	29.831 us
1	1	1.982 us
2	1	2.709 us
3	2	2.573 us
4	3	2.686 us
5	5	2.743 us
6	8	2.746 us
7	13	2.903 us
8	21	2.593 us
9	34	2.786 us
10	55	3.028 us
11	89	3.191 us
12	144	3.006 us
13	233	3.56 us
14	377	3.489 us
15	610	3.595 us
16	987	3.079 us
17	1597	3.448 us
18	2584	2.993 us
19	4181	3.28 us
20	6765	3.043 us
21	10946	3.463 us
22	17711	3.596 us
23	28657	3.663 us
24	46368	3.482 us
25	75025	3.579 us
26	121393	3.534 us
27	196418	3.491 us
28	317811	3.526 us
29	514229	3.673 us
30	832040	3.717 us
31	1346269	3.801 us
32	2178309	3.801 us
33	3524578	3.92 us
34	5702887	3.626 us
35	9227465	3.985 us
36	14930352	3.791 us
37	24157817	3.902 us
38	39088169	3.628 us
39	63245986	3.916 us
40	102334155	3.659 us
41	165580141	3.794 us
42	267914296	3.718 us
43	433494437	3.792 us
44	701408733	3.741 us
45	1134903170	4.071 us
46	1836311903	4.039 us
47	-1323752223	4.299 us
48	512559680	4.129 us
49	-811192543	4.201 us
50	-298632863	3.732 us
51	-1109825406	4 us
52	-1408458269	4.003 us
53	1776683621	4.097 us
54	368225352	4.006 us
55	2144908973	4.027 us
56	-1781832971	3.75 us
57	363076002	4.037 us
58	-1418756969	3.713 us
59	-1055680967	4.042 us
60	1820529360	4.01 us
61	764848393	4.178 us
62	-1709589543	4.334 us
63	-944741150	4.32 us
64	1640636603	4.334 us
65	695895453	4.395 us
66	-1958435240	4.256 us
67	-1262539787	4.271 us
68	1073992269	4.101 us
69	-188547518	4.526 us
70	885444751	12.37 us
71	696897233	4.398 us
72	1582341984	4.214 us
73	-2015728079	4.276 us
74	-433386095	4.136 us
75	1845853122	4.585 us
76	1412467027	4.188 us
77	-1036647147	4.224 us
78	375819880	4.135 us
79	-660827267	4.188 us
80	-285007387	3.933 us
81	-945834654	4.194 us
82	-1230842041	3.828 us
83	2118290601	4.123 us
84	887448560	4.012 us
85	-1289228135	4.172 us
86	-401779575	3.954 us
87	-1691007710	4.126 us
88	-2092787285	4.204 us
89	511172301	4.293 us
90	-1581614984	4.167 us
91	-1070442683	4.371 us
92	1642909629	4.188 us
93	572466946	4.349 us
94	-2079590721	4.646 us
95	-1507123775	4.705 us
96	708252800	4.468 us
97	-798870975	4.555 us
98	-90618175	4.324 us
99	-889489150	4.496 us
100	-980107325	4.398 us
101	-1869596475	4.603 us
102	1445263496	4.365 us
103	-424332979	4.478 us
104	1020930517	4.433 us
105	596597538	4.531 us
106	1617528055	4.502 us
107	-2080841703	4.408 us
108	-463313648	4.341 us
109	1750811945	4.553 us
110	1287498297	4.345 us
111	-1256657054	4.483 us
112	30841243	4.336 us
113	-1225815811	4.577 us
114	-1194974568	4.321 us
115	1874176917	4.504 us
116	679202349	4.498 us
117	-1741588030	4.531 us
118	-1062385681	4.357 us
119	1490993585	4.449 us
120	428607904	4.343 us
121	1919601489	4.547 us
122	-1946757903	4.383 us
123	-27156414	4.57 us
124	-1973914317	4.474 us
125	-2001070731	4.704 us
126	319982248	4.828 us
127	-1681088483	4.856 us
128	-1361106235	4.682 us
129	1252772578	4.781 us
130	-108333657	4.748 us
131	1144438921	4.752 us
132	1036105264	4.709 us
133	-2114423111	4.767 us
134	-1078317847	4.58 us
135	1102226338	4.681 us
136	23908491	4.671 us
137	1126134829	4.734 us
138	1150043320	4.613 us
139	-2018789147	4.641 us
140	-868745827	4.603 us
141	1407432322	4.834 us
142	538686495	4.621 us
143	1946118817	4.692 us
144	-1810161984	4.605 us
145	135956833	4.967 us
146	-1674205151	4.819 us
147	-1538248318	4.677 us
148	1082513827	4.534 us
149	-455734491	4.788 us
150	626779336	4.526 us
151	171044845	4.842 us
152	797824181	4.66 us
153	968869026	4.964 us
154	1766693207	4.732 us
155	-1559405063	4.87 us
156	207288144	9.801 us
157	-1352116919	5.074 us
158	-1144828775	4.731 us
159	1798021602	4.836 us
160	653192827	4.654 us
161	-1843752867	4.743 us
162	-1190560040	4.489 us
163	1260654389	27.627 us
164	70094349	5.156 us
165	1330748738	4.841 us
166	1400843087	4.65 us
167	-1563375471	4.868 us
168	-162532384	4.702 us
169	-1725907855	4.815 us
170	-1888440239	4.679 us
171	680619202	4.863 us
172	-1207821037	4.607 us
173	-527201835	4.874 us
174	-1735022872	4.768 us
175	2032742589	4.845 us
176	297719717	4.772 us
177	-1964504990	4.867 us
178	-1666785273	4.821 us
179	663677033	4.811 us
180	-1003108240	4.73 us
181	-339431207	4.846 us
182	-1342539447	4.596 us
183	-1681970654	5.016 us
184	1270457195	4.757 us
185	-411513459	4.975 us
186	858943736	4.747 us
187	447430277	4.956 us
188	1306374013	4.884 us
189	1753804290	4.829 us
190	-1234788993	4.835 us
191	519015297	4.908 us
192	-715773696	4.896 us
193	-196758399	4.89 us
194	-912532095	6.341 us
195	-1109290494	4.882 us
196	-2021822589	4.863 us
197	1163854213	5.081 us
198	-857968376	4.334 us
199	305885837	4.747 us
200	-552082539	4.615 us
201	-246196702	4.766 us
202	-798279241	4.558 us
203	-1044475943	4.629 us
204	-1842755184	4.701 us
205	1407736169	4.785 us
206	-435019015	4.463 us
207	972717154	4.887 us
208	537698139	4.162 us
209	1510415293	4.605 us
210	2048113432	4.071 us
211	-736438571	4.408 us
212	1311674861	4.221 us
213	575236290	4.502 us
214	1886911151	4.435 us
215	-1832819855	4.645 us
216	54091296	4.541 us
217	-1778728559	4.729 us
218	-1724637263	4.717 us
219	791601474	4.904 us
220	-933035789	4.599 us
221	-141434315	4.681 us
222	-1074470104	4.465 us
223	-1215904419	4.776 us
224	2004592773	4.641 us
225	788688354	4.623 us
226	-1501686169	4.623 us
227	-712997815	4.736 us
228	2080283312	4.577 us
229	1367285497	4.927 us
230	-847398487	4.658 us
231	519887010	4.732 us
232	-327511477	4.673 us
233	192375533	4.831 us
234	-135135944	4.572 us
235	57239589	4.809 us
236	-77896355	4.576 us
237	-20656766	4.729 us
238	-98553121	4.581 us
239	-119209887	4.803 us
240	-217763008	4.576 us
241	-336972895	9.196 us
242	-554735903	4.62 us
243	-891708798	4.657 us
244	-1446444701	4.673 us
245	1956813797	4.92 us
246	510369096	4.688 us
247	-1827784403	4.671 us
248	-1317415307	4.486 us
249	1149767586	4.87 us
250	-167647721	4.764 us
251	982119865	4.797 us
252	814472144	4.634 us
253	1796592009	4.758 us
254	-1683903143	4.83 us
255	112688866	5.145 us
256	-1571214277	4.844 us
257	-1458525411	5.052 us
258	1265227608	4.937 us
259	-193297803	5.057 us
260	1071929805	4.807 us
261	878632002	5.002 us
262	1950561807	4.934 us
263	-1465773487	4.936 us
264	484788320	4.794 us
265	-980985167	5.193 us
266	-496196847	4.987 us
267	-1477182014	4.886 us
268	-1973378861	4.704 us
269	844406421	4.966 us
270	-1128972440	4.866 us
271	-284566019	4.872 us
272	-1413538459	4.839 us
273	-1698104478	4.89 us
274	1183324359	4.837 us
275	-514780119	5.021 us
276	668544240	4.904 us
277	153764121	4.939 us
278	822308361	4.799 us
279	976072482	5.095 us
280	1798380843	4.864 us
281	-1520513971	5.061 us
282	277866872	4.76 us
283	-1242647099	4.928 us
284	-964780227	4.775 us
285	2087539970	5.147 us
286	1122759743	4.878 us
287	-1084667583	5.042 us
288	38092160	5.018 us
289	-1046575423	5.022 us
290	-1008483263	4.758 us
291	-2055058686	4.949 us
292	1231425347	4.963 us
293	-823633339	5.03 us
294	407792008	4.75 us
295	-415841331	4.918 us
296	-8049323	4.82 us
297	-423890654	4.948 us
298	-431939977	4.645 us
299	-855830631	5.051 us
```


Clearly, caching is very effective!
Also clearly, `int` is not nearly big enough for this
problem.


