# Recursive Fibbonacci With and Without Cache

The naive recursive Fibbonacci algorithm is infamous
for being bad. However, caching can make it good!


```CPP
// C++ code
#include <iostream>
#include <chrono>
#include <map>

int fibb(int n) {
  if (n < 2) {
    return n;
  }
  return fibb(n - 2) + fibb(n - 1);
}

int fibb_with_cache(int n) {
  static std::map<int, int> cache;
  if (cache.count(n) == 0) {
    if (n < 2) {
      cache[n] = n;
    } else {
      cache[n] = fibb_with_cache(n - 2) +
                 fibb_with_cache(n - 1);
    }
  }
  return cache.at(n);
}

int main() {
  std::cout << "Without cache:\n";
  for (int i = 0; i < 30; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }
  
  std::cout << "With cache:\n";
  for (int i = 0; i < 300; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb_with_cache(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }

  return 0;
}
```

```
Without cache:
0	0	3.168 us
1	1	0.353 us
2	1	0.303 us
3	2	0.328 us
4	3	0.298 us
5	5	0.361 us
6	8	0.393 us
7	13	0.576 us
8	21	0.683 us
9	34	0.786 us
10	55	0.997 us
11	89	1.458 us
12	144	2.109 us
13	233	3.28 us
14	377	5.106 us
15	610	8.056 us
16	987	12.765 us
17	1597	20.594 us
18	2584	33.022 us
19	4181	53.08 us
20	6765	85.706 us
21	10946	186.147 us
22	17711	277.241 us
23	28657	435.502 us
24	46368	778.333 us
25	75025	1141.64 us
26	121393	1994.4 us
27	196418	3349.26 us
28	317811	4314.18 us
29	514229	6807.57 us
With cache:
0	0	17.425 us
1	1	1.328 us
2	1	1.935 us
3	2	1.906 us
4	3	2.014 us
5	5	2.001 us
6	8	2.022 us
7	13	2.197 us
8	21	1.907 us
9	34	2.013 us
10	55	2.257 us
11	89	2.283 us
12	144	2.162 us
13	233	2.285 us
14	377	2.479 us
15	610	2.428 us
16	987	2.292 us
17	1597	2.395 us
18	2584	2.313 us
19	4181	2.345 us
20	6765	2.312 us
21	10946	2.438 us
22	17711	2.558 us
23	28657	2.655 us
24	46368	2.509 us
25	75025	2.616 us
26	121393	2.489 us
27	196418	2.568 us
28	317811	2.472 us
29	514229	2.557 us
30	832040	2.65 us
31	1346269	2.748 us
32	2178309	2.639 us
33	3524578	2.739 us
34	5702887	2.647 us
35	9227465	2.712 us
36	14930352	2.669 us
37	24157817	2.782 us
38	39088169	2.658 us
39	63245986	2.819 us
40	102334155	2.641 us
41	165580141	2.785 us
42	267914296	2.609 us
43	433494437	2.706 us
44	701408733	2.631 us
45	1134903170	2.781 us
46	1836311903	2.848 us
47	-1323752223	3.004 us
48	512559680	2.802 us
49	-811192543	2.961 us
50	-298632863	2.838 us
51	-1109825406	2.918 us
52	-1408458269	2.833 us
53	1776683621	2.959 us
54	368225352	2.808 us
55	2144908973	2.936 us
56	-1781832971	2.839 us
57	363076002	2.903 us
58	-1418756969	2.811 us
59	-1055680967	2.896 us
60	1820529360	2.814 us
61	764848393	2.913 us
62	-1709589543	2.978 us
63	-944741150	3.108 us
64	1640636603	2.982 us
65	695895453	3.057 us
66	-1958435240	3.008 us
67	-1262539787	3.063 us
68	1073992269	3.033 us
69	-188547518	3.123 us
70	885444751	9.284 us
71	696897233	3.07 us
72	1582341984	2.994 us
73	-2015728079	3.099 us
74	-433386095	3.007 us
75	1845853122	3.075 us
76	1412467027	2.943 us
77	-1036647147	3.122 us
78	375819880	2.983 us
79	-660827267	3.08 us
80	-285007387	2.961 us
81	-945834654	3.068 us
82	-1230842041	2.976 us
83	2118290601	3.066 us
84	887448560	2.998 us
85	-1289228135	3.076 us
86	-401779575	3.01 us
87	-1691007710	3.068 us
88	-2092787285	25.33 us
89	511172301	3.238 us
90	-1581614984	3.09 us
91	-1070442683	3.158 us
92	1642909629	3.133 us
93	572466946	3.312 us
94	-2079590721	3.271 us
95	-1507123775	4.133 us
96	708252800	4.033 us
97	-798870975	4.041 us
98	-90618175	3.682 us
99	-889489150	4.01 us
100	-980107325	3.758 us
101	-1869596475	4.021 us
102	1445263496	4.273 us
103	-424332979	4.213 us
104	1020930517	3.964 us
105	596597538	3.549 us
106	1617528055	3.132 us
107	-2080841703	3.27 us
108	-463313648	3.14 us
109	1750811945	3.268 us
110	1287498297	3.14 us
111	-1256657054	3.216 us
112	30841243	3.144 us
113	-1225815811	3.245 us
114	-1194974568	3.11 us
115	1874176917	3.217 us
116	679202349	3.1 us
117	-1741588030	3.234 us
118	-1062385681	3.156 us
119	1490993585	3.262 us
120	428607904	3.095 us
121	1919601489	3.188 us
122	-1946757903	3.169 us
123	-27156414	3.277 us
124	-1973914317	3.143 us
125	-2001070731	3.232 us
126	319982248	3.252 us
127	-1681088483	3.336 us
128	-1361106235	3.278 us
129	1252772578	3.408 us
130	-108333657	3.329 us
131	1144438921	3.344 us
132	1036105264	3.289 us
133	-2114423111	3.362 us
134	-1078317847	3.249 us
135	1102226338	3.362 us
136	23908491	3.303 us
137	1126134829	3.413 us
138	1150043320	3.308 us
139	-2018789147	3.426 us
140	-868745827	3.291 us
141	1407432322	3.443 us
142	538686495	3.327 us
143	1946118817	3.387 us
144	-1810161984	3.319 us
145	135956833	3.51 us
146	-1674205151	3.326 us
147	-1538248318	3.397 us
148	1082513827	3.253 us
149	-455734491	3.419 us
150	626779336	3.292 us
151	171044845	3.41 us
152	797824181	3.304 us
153	968869026	3.493 us
154	1766693207	3.308 us
155	-1559405063	3.411 us
156	207288144	6.55 us
157	-1352116919	3.638 us
158	-1144828775	3.34 us
159	1798021602	3.478 us
160	653192827	3.313 us
161	-1843752867	3.42 us
162	-1190560040	3.331 us
163	1260654389	10.785 us
164	70094349	3.394 us
165	1330748738	34.412 us
166	1400843087	3.96 us
167	-1563375471	4.184 us
168	-162532384	4.178 us
169	-1725907855	4.163 us
170	-1888440239	4.13 us
171	680619202	4.173 us
172	-1207821037	4.079 us
173	-527201835	4.233 us
174	-1735022872	3.997 us
175	2032742589	4.152 us
176	297719717	4.094 us
177	-1964504990	22.163 us
178	-1666785273	3.474 us
179	663677033	3.561 us
180	-1003108240	3.433 us
181	-339431207	3.6 us
182	-1342539447	3.439 us
183	-1681970654	3.595 us
184	1270457195	3.47 us
185	-411513459	3.563 us
186	858943736	3.484 us
187	447430277	3.592 us
188	1306374013	3.447 us
189	1753804290	3.608 us
190	-1234788993	3.638 us
191	519015297	21.539 us
192	-715773696	3.474 us
193	-196758399	3.619 us
194	-912532095	3.485 us
195	-1109290494	3.616 us
196	-2021822589	3.488 us
197	1163854213	3.608 us
198	-857968376	3.494 us
199	305885837	3.572 us
200	-552082539	3.435 us
201	-246196702	3.603 us
202	-798279241	3.496 us
203	-1044475943	3.594 us
204	-1842755184	3.468 us
205	1407736169	3.633 us
206	-435019015	3.483 us
207	972717154	3.599 us
208	537698139	3.503 us
209	1510415293	3.567 us
210	2048113432	3.454 us
211	-736438571	3.594 us
212	1311674861	3.459 us
213	575236290	3.621 us
214	1886911151	3.454 us
215	-1832819855	3.592 us
216	54091296	3.468 us
217	-1778728559	3.607 us
218	-1724637263	3.477 us
219	791601474	3.548 us
220	-933035789	3.482 us
221	-141434315	3.692 us
222	-1074470104	3.492 us
223	-1215904419	3.579 us
224	2004592773	3.696 us
225	788688354	3.59 us
226	-1501686169	3.427 us
227	-712997815	3.596 us
228	2080283312	3.406 us
229	1367285497	3.58 us
230	-847398487	3.438 us
231	519887010	3.628 us
232	-327511477	3.473 us
233	192375533	3.632 us
234	-135135944	3.438 us
235	57239589	3.598 us
236	-77896355	3.454 us
237	-20656766	3.568 us
238	-98553121	3.399 us
239	-119209887	3.577 us
240	-217763008	3.526 us
241	-336972895	5.929 us
242	-554735903	3.398 us
243	-891708798	3.518 us
244	-1446444701	3.442 us
245	1956813797	3.576 us
246	510369096	3.444 us
247	-1827784403	3.611 us
248	-1317415307	3.385 us
249	1149767586	3.583 us
250	-167647721	3.464 us
251	982119865	3.601 us
252	814472144	3.504 us
253	1796592009	3.658 us
254	-1683903143	3.623 us
255	112688866	3.731 us
256	-1571214277	3.589 us
257	-1458525411	3.802 us
258	1265227608	3.593 us
259	-193297803	3.81 us
260	1071929805	3.616 us
261	878632002	3.816 us
262	1950561807	3.588 us
263	-1465773487	3.745 us
264	484788320	3.591 us
265	-980985167	3.794 us
266	-496196847	3.584 us
267	-1477182014	3.77 us
268	-1973378861	3.594 us
269	844406421	3.813 us
270	-1128972440	3.634 us
271	-284566019	3.795 us
272	-1413538459	3.592 us
273	-1698104478	3.738 us
274	1183324359	3.614 us
275	-514780119	3.75 us
276	668544240	3.665 us
277	153764121	3.808 us
278	822308361	3.641 us
279	976072482	3.745 us
280	1798380843	3.675 us
281	-1520513971	3.71 us
282	277866872	3.674 us
283	-1242647099	3.806 us
284	-964780227	3.678 us
285	2087539970	3.822 us
286	1122759743	3.602 us
287	-1084667583	3.775 us
288	38092160	3.654 us
289	-1046575423	3.805 us
290	-1008483263	3.596 us
291	-2055058686	3.814 us
292	1231425347	3.643 us
293	-823633339	3.844 us
294	407792008	3.612 us
295	-415841331	3.71 us
296	-8049323	3.622 us
297	-423890654	3.768 us
298	-431939977	3.607 us
299	-855830631	3.755 us
```


Clearly, caching is very effective!


