# Recursive Fibbonacci With and Without Cache

The naive recursive Fibbonacci algorithm is infamous
for being bad. However, caching can make it good!


```CPP
// C++ code
#include <iostream>
#include <chrono>
#include <map>

int fibb(int n) {
  if (n < 2) {
    return n;
  }
  return fibb(n - 2) + fibb(n - 1);
}

int fibb_with_cache(int n) {
  static std::map<int, int> cache;
  if (cache.count(n) == 0) {
    if (n < 2) {
      cache[n] = n;
    } else {
      cache[n] = fibb_with_cache(n - 2) +
                 fibb_with_cache(n - 1);
    }
  }
  return cache.at(n);
}

int main() {
  std::cout << "Without cache:\n";
  for (int i = 0; i < 30; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }
  
  std::cout << "With cache:\n";
  for (int i = 0; i < 300; ++i) {
    auto a = std::chrono::high_resolution_clock::now();
    std::cout << i << '\t' << fibb_with_cache(i) << '\t';
    auto b = std::chrono::high_resolution_clock::now();
    std::cout << std::chrono::duration_cast<
      std::chrono::nanoseconds>(b - a).count() / 1000.0
      << " us\n";
  }

  return 0;
}
```

```
Without cache:
0	0	3.681 us
1	1	0.333 us
2	1	0.274 us
3	2	0.268 us
4	3	0.277 us
5	5	0.323 us
6	8	0.41 us
7	13	0.521 us
8	21	0.598 us
9	34	0.679 us
10	55	1.022 us
11	89	1.38 us
12	144	1.928 us
13	233	2.964 us
14	377	4.638 us
15	610	7.312 us
16	987	11.73 us
17	1597	18.756 us
18	2584	30.156 us
19	4181	48.747 us
20	6765	78.29 us
21	10946	203.646 us
22	17711	222.155 us
23	28657	330.326 us
24	46368	612.947 us
25	75025	999.971 us
26	121393	1768.04 us
27	196418	3287.35 us
28	317811	3755.5 us
29	514229	6301.05 us
With cache:
0	0	14.064 us
1	1	1.5 us
2	1	2.091 us
3	2	2.003 us
4	3	2.123 us
5	5	2.238 us
6	8	2.199 us
7	13	2.173 us
8	21	1.921 us
9	34	2.132 us
10	55	2.365 us
11	89	2.373 us
12	144	2.298 us
13	233	2.465 us
14	377	2.631 us
15	610	2.598 us
16	987	2.437 us
17	1597	2.524 us
18	2584	2.339 us
19	4181	2.448 us
20	6765	2.333 us
21	10946	2.576 us
22	17711	2.755 us
23	28657	2.712 us
24	46368	2.659 us
25	75025	2.734 us
26	121393	2.624 us
27	196418	2.716 us
28	317811	2.56 us
29	514229	2.718 us
30	832040	2.749 us
31	1346269	2.894 us
32	2178309	2.759 us
33	3524578	2.879 us
34	5702887	2.744 us
35	9227465	2.857 us
36	14930352	2.765 us
37	24157817	2.957 us
38	39088169	2.78 us
39	63245986	2.85 us
40	102334155	2.785 us
41	165580141	2.931 us
42	267914296	2.737 us
43	433494437	2.831 us
44	701408733	2.761 us
45	1134903170	2.957 us
46	1836311903	2.953 us
47	-1323752223	3.147 us
48	512559680	2.947 us
49	-811192543	3.092 us
50	-298632863	2.957 us
51	-1109825406	3.041 us
52	-1408458269	2.954 us
53	1776683621	3.127 us
54	368225352	2.975 us
55	2144908973	3.112 us
56	-1781832971	2.967 us
57	363076002	3.023 us
58	-1418756969	2.857 us
59	-1055680967	2.998 us
60	1820529360	2.883 us
61	764848393	3.036 us
62	-1709589543	3.012 us
63	-944741150	3.206 us
64	1640636603	3.127 us
65	695895453	3.201 us
66	-1958435240	3.1 us
67	-1262539787	3.132 us
68	1073992269	3.042 us
69	-188547518	3.267 us
70	885444751	13.405 us
71	696897233	3.225 us
72	1582341984	3.101 us
73	-2015728079	3.406 us
74	-433386095	3.093 us
75	1845853122	3.256 us
76	1412467027	3.142 us
77	-1036647147	3.209 us
78	375819880	3.14 us
79	-660827267	18.159 us
80	-285007387	3.074 us
81	-945834654	3.084 us
82	-1230842041	2.958 us
83	2118290601	3.164 us
84	887448560	2.967 us
85	-1289228135	3.057 us
86	-401779575	2.936 us
87	-1691007710	3.034 us
88	-2092787285	22.675 us
89	511172301	3.738 us
90	-1581614984	3.564 us
91	-1070442683	3.848 us
92	1642909629	3.507 us
93	572466946	3.822 us
94	-2079590721	3.791 us
95	-1507123775	3.938 us
96	708252800	4.56 us
97	-798870975	5.001 us
98	-90618175	4.361 us
99	-889489150	4.948 us
100	-980107325	4.896 us
101	-1869596475	4.943 us
102	1445263496	4.613 us
103	-424332979	4.935 us
104	1020930517	4.769 us
105	596597538	5.036 us
106	1617528055	3.88 us
107	-2080841703	4.011 us
108	-463313648	3.831 us
109	1750811945	4.023 us
110	1287498297	3.857 us
111	-1256657054	3.955 us
112	30841243	3.867 us
113	-1225815811	3.952 us
114	-1194974568	3.799 us
115	1874176917	3.995 us
116	679202349	3.818 us
117	-1741588030	4.011 us
118	-1062385681	3.783 us
119	1490993585	3.98 us
120	428607904	3.873 us
121	1919601489	3.943 us
122	-1946757903	3.792 us
123	-27156414	3.982 us
124	-1973914317	3.778 us
125	-2001070731	4.029 us
126	319982248	4.098 us
127	-1681088483	4.209 us
128	-1361106235	3.94 us
129	1252772578	4.308 us
130	-108333657	4.011 us
131	1144438921	4.154 us
132	1036105264	4.013 us
133	-2114423111	13.537 us
134	-1078317847	3.974 us
135	1102226338	4.2 us
136	23908491	4.067 us
137	1126134829	4.202 us
138	1150043320	4.026 us
139	-2018789147	4.183 us
140	-868745827	4.042 us
141	1407432322	4.199 us
142	538686495	4.003 us
143	1946118817	4.123 us
144	-1810161984	4.032 us
145	135956833	4.22 us
146	-1674205151	4.009 us
147	-1538248318	4.142 us
148	1082513827	4.049 us
149	-455734491	19.009 us
150	626779336	3.345 us
151	171044845	3.345 us
152	797824181	3.319 us
153	968869026	3.39 us
154	1766693207	3.252 us
155	-1559405063	3.394 us
156	207288144	6.821 us
157	-1352116919	3.553 us
158	-1144828775	3.302 us
159	1798021602	3.347 us
160	653192827	3.278 us
161	-1843752867	3.391 us
162	-1190560040	3.309 us
163	1260654389	9.118 us
164	70094349	3.454 us
165	1330748738	3.476 us
166	1400843087	3.299 us
167	-1563375471	3.384 us
168	-162532384	3.277 us
169	-1725907855	3.421 us
170	-1888440239	3.248 us
171	680619202	23.806 us
172	-1207821037	4.003 us
173	-527201835	4.2 us
174	-1735022872	4.025 us
175	2032742589	4.128 us
176	297719717	4.02 us
177	-1964504990	4.093 us
178	-1666785273	4.032 us
179	663677033	4.168 us
180	-1003108240	3.989 us
181	-339431207	4.186 us
182	-1342539447	4.049 us
183	-1681970654	4.088 us
184	1270457195	4.018 us
185	-411513459	4.197 us
186	858943736	4.082 us
187	447430277	4.226 us
188	1306374013	4.035 us
189	1753804290	4.208 us
190	-1234788993	4.168 us
191	519015297	4.387 us
192	-715773696	4.265 us
193	-196758399	4.398 us
194	-912532095	4.254 us
195	-1109290494	4.353 us
196	-2021822589	4.24 us
197	1163854213	4.395 us
198	-857968376	4.242 us
199	305885837	4.409 us
200	-552082539	4.276 us
201	-246196702	4.453 us
202	-798279241	4.249 us
203	-1044475943	4.384 us
204	-1842755184	18.798 us
205	1407736169	3.634 us
206	-435019015	3.471 us
207	972717154	3.567 us
208	537698139	3.403 us
209	1510415293	3.648 us
210	2048113432	3.537 us
211	-736438571	3.612 us
212	1311674861	3.484 us
213	575236290	3.641 us
214	1886911151	3.458 us
215	-1832819855	3.618 us
216	54091296	3.472 us
217	-1778728559	3.622 us
218	-1724637263	3.49 us
219	791601474	3.557 us
220	-933035789	3.492 us
221	-141434315	3.632 us
222	-1074470104	3.508 us
223	-1215904419	3.517 us
224	2004592773	3.499 us
225	788688354	3.554 us
226	-1501686169	3.485 us
227	-712997815	3.614 us
228	2080283312	3.494 us
229	1367285497	3.63 us
230	-847398487	3.451 us
231	519887010	3.557 us
232	-327511477	3.502 us
233	192375533	3.607 us
234	-135135944	3.464 us
235	57239589	3.568 us
236	-77896355	3.461 us
237	-20656766	3.637 us
238	-98553121	3.489 us
239	-119209887	3.567 us
240	-217763008	3.473 us
241	-336972895	5.495 us
242	-554735903	3.467 us
243	-891708798	3.556 us
244	-1446444701	3.46 us
245	1956813797	3.616 us
246	510369096	3.567 us
247	-1827784403	3.64 us
248	-1317415307	3.474 us
249	1149767586	3.577 us
250	-167647721	3.461 us
251	982119865	3.618 us
252	814472144	3.511 us
253	1796592009	3.627 us
254	-1683903143	3.657 us
255	112688866	3.715 us
256	-1571214277	3.624 us
257	-1458525411	3.765 us
258	1265227608	3.631 us
259	-193297803	3.782 us
260	1071929805	3.574 us
261	878632002	3.75 us
262	1950561807	3.624 us
263	-1465773487	3.744 us
264	484788320	3.65 us
265	-980985167	3.806 us
266	-496196847	3.651 us
267	-1477182014	3.746 us
268	-1973378861	3.618 us
269	844406421	3.787 us
270	-1128972440	3.676 us
271	-284566019	3.76 us
272	-1413538459	3.649 us
273	-1698104478	3.802 us
274	1183324359	3.641 us
275	-514780119	3.738 us
276	668544240	3.67 us
277	153764121	3.768 us
278	822308361	3.618 us
279	976072482	3.783 us
280	1798380843	3.605 us
281	-1520513971	3.743 us
282	277866872	3.602 us
283	-1242647099	18.537 us
284	-964780227	3.515 us
285	2087539970	3.574 us
286	1122759743	3.488 us
287	-1084667583	3.558 us
288	38092160	3.473 us
289	-1046575423	3.624 us
290	-1008483263	3.507 us
291	-2055058686	3.628 us
292	1231425347	3.514 us
293	-823633339	3.646 us
294	407792008	3.46 us
295	-415841331	3.593 us
296	-8049323	3.495 us
297	-423890654	3.605 us
298	-431939977	3.478 us
299	-855830631	3.615 us
```


Clearly, caching is very effective!
Also clearly, `int` is not nearly big enough for this
problem.


